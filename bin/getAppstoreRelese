#!/usr/bin/env python
# -*- coding: utf-8 -*-

# Test your regular expression here:  https://pythex.org/

import urllib2
import re
import sys

def getAppdataIOS(urlstring):
  src=urllib2.urlopen(urlstring).read()
  regexp='<h1>(?P<titolo>.*?)</h1>(.*)ato: </span>(?P<dtr>.*?)</li>(.*)Versione: </span>(?P<versione>.*?)\</li\>'
  
  tok = re.search(regexp, src, re.S|re.I)

  tit = tok.group("titolo").strip()
  ver = tok.group("versione").strip()
  dtr = tok.group("dtr").strip()

  return tit, ver, dtr

def getAppdataANDROID(urlstring):
  src=urllib2.urlopen(urlstring).read()
  regexp='itemprop="name"> <div>(?P<titolo>.*?)</div>(.*)datePublished">(?P<dtr>.*?)</div>(.*)softwareVersion">(?P<versione>.*?)</div>'
  
  tok = re.search(regexp, src, re.S|re.I)

  #tit = tok.group("titolo").strip()
 
  tit = tok.group("titolo").strip().replace("Ã¨","e'")
  ver = tok.group("versione").strip()
  dtr = tok.group("dtr").strip()

  dtr = dtr.replace("gennaio","/01/")
  dtr = dtr.replace("febbraio","/02/")
  dtr = dtr.replace("marzo","/03/")
  dtr = dtr.replace("aprile","/04/")
  dtr = dtr.replace("maggio","/05/")
  dtr = dtr.replace("giugno","/06/")
  dtr = dtr.replace("luglio","/07/")
  dtr = dtr.replace("agosto","/08/")
  dtr = dtr.replace("settembre","/09/")
  dtr = dtr.replace("ottobre","/10/")
  dtr = dtr.replace("novembre","/11/")
  dtr = dtr.replace("dicembre","/12/")
  dtr = dtr.replace(" ","")

  return tit, ver, dtr


def bar(versione):
  rels = versione.split(".")
  return '*' * int(rels[0]) + "-" * int(rels[1])

def header(title):
  print ''
  print title
  print\
  #print len(title) * '-'
  print 'Application'.ljust(18, ' ') + ' | ' + 'Release'.ljust(8,' ') + ' | ' + 'Date'.ljust(10,' ') + ' | '
  print '-' * 44

def body(appName, appRel, appDate):
    print appName.ljust(18, ' ') + ' | ' + appRel.ljust(8,' ') + ' | ' + appDate.ljust(10,' ') + ' | ' + bar(appRel).ljust(15,' ') 

# Main
# -----

iOrderApps = [
  "https://itunes.apple.com/it/app/ib/id544373413?mt=8",
  "https://itunes.apple.com/it/app/igamma/id417013645?mt=8",
  "https://itunes.apple.com/it/app/izeta/id700840887?mt=8",
  "https://itunes.apple.com/it/app/icommerce/id567772952?mt=8",
  "https://itunes.apple.com/it/app/diwine/id838123903?mt=8",
  "https://itunes.apple.com/it/app/wtrendy/id642932906?mt=8",
  "https://itunes.apple.com/it/app/ibiz/id871060765?mt=8",
]

iCalcioAppIOS = [
  "https://itunes.apple.com/it/app/icesena/id400463494&mt=8",
  "https://itunes.apple.com/it/app/irossoneri/id430836283?mt=8",
  "https://itunes.apple.com/it/app/inapoletani/id492698557&mt=8",
  "https://itunes.apple.com/it/app/iatalanta-fc/id671839228?mt=8",
  "https://itunes.apple.com/it/app/iromanisti/id672205172?mt=8",
  "https://itunes.apple.com/it/app/jvts/id671813861&mt=8",
  "https://itunes.apple.com/it/app/icataniacalcio/id410610802&mt=8",
  "https://itunes.apple.com/it/app/ifiorentina-calcio/id411642947&mt=8",
]

iCalcioAppANDROID = [
  "https://play.google.com/store/apps/details?id=forzaCesena.apexnet.it",
  "https://play.google.com/store/apps/details?id=it.apexnet.app.calcio.forzainter",
  "https://play.google.com/store/apps/details?id=it.apexnet.app.calcio.alecatania",
  "https://play.google.com/store/apps/details?id=it.apexnet.app.calcio.magicaroma",
  "https://play.google.com/store/apps/details?id=it.apexnet.calcio.app.forzaBrescia",
]




header('iOrder')
for app in iOrderApps:
    appName, appRel, appDate = getAppdataIOS(app)
    body(appName, appRel, appDate)
 
header('iCalcio iOS')
for app in iCalcioAppIOS:
    appName, appRel, appDate = getAppdataIOS(app)
    body(appName, appRel, appDate)

header('iCalcio Android')
for app in iCalcioAppANDROID:
    appName, appRel, appDate = getAppdataANDROID(app)
    body(appName, appRel, appDate) 

print
